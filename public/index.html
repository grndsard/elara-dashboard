<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elara (Enriched Kisel Analytics for Real-time Access)</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    
    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
        <h2>ELARA</h2>
        <p>Enriched Kisel Analytics for Real-time Access</p>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-container" style="display: none;">
        <div class="login-card animate__animated animate__fadeInUp">
            <div class="login-header">
                <img src="/images/elara-logo.svg" alt="Elara" class="logo">
                <h1>ELARA</h1>
                <p>Enriched Kisel Analytics for Real-time Access</p>
            </div>
            
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="email" name="email" placeholder="Email Address" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" name="password" placeholder="Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
            </form>
            
            <div class="login-footer">
                <a href="javascript:void(0)" onclick="showForgotPassword(); return false;">Forgot Password?</a>
            </div>
            </form>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="modal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <h2>Reset Password</h2>
                <span class="close" onclick="closeForgotPassword()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="forgot-password-form">
                    <div class="form-group">
                        <label for="forgot-email">Email Address</label>
                        <input type="email" id="forgot-email" name="email" placeholder="Enter your email address" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeForgotPassword()">Cancel</button>
                        <button type="submit" class="btn-primary">Send Reset Link</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reset Password Page -->
    <div id="reset-password-page" class="login-container" style="display: none;">
        <div class="login-card animate__animated animate__fadeInUp">
            <div class="login-header">
                <img src="/images/elara-logo.svg" alt="Elara" class="logo">
                <h1>Reset Password</h1>
                <p>Enter your new password</p>
            </div>
            
            <form id="reset-password-form" class="login-form">
                <div class="form-group">
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="new-password" name="password" placeholder="New Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('new-password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirm-password" name="confirmPassword" placeholder="Confirm Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('confirm-password')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary">
                    <i class="fas fa-key"></i>
                    Reset Password
                </button>
            </form>
        </div>
    </div>

    <!-- Force Password Change Modal -->
    <div id="force-password-change-modal" class="modal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <h2>Password Change Required</h2>
            </div>
            <div class="modal-body">
                <p style="margin: 0 0 20px 0; color: #666; text-align: center;">For security reasons, you must change your password before continuing.</p>
                <form id="force-password-change-form">
                    <div class="form-group form-group-full">
                        <label for="current-password">Current Password</label>
                        <div class="input-group">
                            <input type="password" id="current-password" name="currentPassword" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('current-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="force-new-password">New Password</label>
                        <div class="input-group">
                            <input type="password" id="force-new-password" name="password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('force-new-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="form-help">Password must be at least 8 characters long</small>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="force-confirm-password">Confirm New Password</label>
                        <div class="input-group">
                            <input type="password" id="force-confirm-password" name="confirmPassword" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('force-confirm-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn-primary">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" style="display: none;">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-brand">
                <img src="/images/elara-logo.svg" alt="Elara" class="nav-logo">
                <span>Elara</span>
            </div>
            
            <div class="nav-menu">
                <a href="#" data-page="dashboard" class="nav-item active">
                    <i class="fas fa-chart-line"></i>
                    Dashboard
                </a>
                <a href="#" data-page="ask-data" class="nav-item">
                    <i class="fas fa-robot"></i>
                    Ask Your Data
                </a>
                <div class="nav-dropdown" id="master-data-menu">
                    <a href="javascript:void(0)" class="nav-item">
                        <i class="fas fa-database"></i>
                        Master Data
                        <i class="fas fa-chevron-down"></i>
                    </a>
                    <div class="dropdown-content">
                        <a href="#" data-page="users">
                            <i class="fas fa-users"></i>
                            User Data
                        </a>
                        <a href="#" data-page="datasets">
                            <i class="fas fa-file-excel"></i>
                            Dataset
                        </a>
                        <a href="#" data-page="audit">
                            <i class="fas fa-history"></i>
                            Audit Trail
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="nav-user">
                <div class="user-dropdown">
                    <img src="/images/default-avatar.svg" alt="User" class="user-avatar" id="user-avatar">
                    <span id="user-name">User</span>
                    <i class="fas fa-chevron-down"></i>
                    <div class="dropdown-content">
                        <a href="#" data-page="profile">
                            <i class="fas fa-user-cog"></i>
                            Profile Settings
                        </a>
                        <a href="#" data-action="logout">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Page Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page-content">
                <div class="page-header">
                    <h1>Financial Dashboard</h1>
                </div>
                
                <div class="dashboard-filters-horizontal">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="dataset-filter">Data Source</label>
                            <select id="dataset-filter" onchange="applyFilters()">
                                <option value="all">All Datasets</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="entity-filter">Entity</label>
                            <select id="entity-filter" onchange="applyFilters()">
                                <option value="all">All Entities</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="region-filter">Region</label>
                            <select id="region-filter" onchange="applyFilters()">
                                <option value="all">All Regions</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="month-filter">Month</label>
                            <select id="month-filter" onchange="applyFilters()">
                                <option value="all">All Months</option>
                                <!-- Options populated dynamically -->
                            </select>
                        </div>
                        

                    </div>
                </div>
                
                <div class="dashboard-cards">
                    <div class="card animate__animated animate__fadeInUp">
                        <div class="card-header">
                            <h3>Revenue Console</h3>
                            <i class="fas fa-chart-line card-icon"></i>
                        </div>
                        <div class="card-value" id="total-revenue">$0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i>
                            Total Revenue for All Entities
                        </div>
                    </div>
                    
                    <div class="card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
                        <div class="card-header">
                            <h3>Gross Profit Console</h3>
                            <i class="fas fa-chart-bar card-icon"></i>
                        </div>
                        <div class="card-value" id="total-cogs">$0</div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-down"></i>
                            Total GP for All Entities
                        </div>
                    </div>
                    
                    <div class="card animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
                        <div class="card-header">
                            <h3>EBITDA</h3>
                            <i class="fas fa-calculator card-icon"></i>
                        </div>
                        <div class="card-value" id="total-ebitda">$0</div>
                        <div class="card-change positive">
                            <i class="fas fa-chart-pie"></i>
                            Earnings Before Interest, Taxes, Depreciation, and Amortization
                        </div>
                    </div>
                    
                    <div class="card animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
                        <div class="card-header">
                            <h3>Nett Income Console</h3>
                            <i class="fas fa-dollar-sign card-icon"></i>
                        </div>
                        <div class="card-value" id="total-nett-income">$0</div>
                        <div class="card-change positive">
                            <i class="fas fa-chart-area"></i>
                            Net Income After All Expenses
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-charts">
                    <div class="chart-container animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
                        <div class="chart-header">
                            <h3>Revenue per Entity</h3>
                        </div>
                        <canvas id="revenue-chart"></canvas>
                    </div>
                    
                    <div class="chart-container animate__animated animate__fadeInUp" style="animation-delay: 0.5s;">
                        <div class="chart-header">
                            <h3>Gross Profit per Entity</h3>
                        </div>
                        <canvas id="cogs-chart"></canvas>
                    </div>
                    
                    <div class="chart-container animate__animated animate__fadeInUp" style="animation-delay: 0.6s;">
                        <div class="chart-header">
                            <h3>EBITDA per Entity</h3>
                        </div>
                        <canvas id="ebitda-chart"></canvas>
                    </div>
                    
                    <div class="chart-container animate__animated animate__fadeInUp" style="animation-delay: 0.7s;">
                        <div class="chart-header">
                            <h3>Nett Income per Entity</h3>
                        </div>
                        <canvas id="nett-income-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Ask Your Data Page -->
            <div id="ask-data-page" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1>Ask Your Data</h1>
                    <p>Use Amazon Q Business to query your financial data with natural language</p>
                </div>
                
                <div class="qbusiness-container">
                    <div class="qbusiness-header">
                        <div class="qbusiness-status" id="qbusiness-status">
                            <i class="fas fa-circle" id="status-indicator"></i>
                            <span id="status-text">Connecting to Amazon Q Business...</span>
                        </div>
                        <button class="btn-secondary" onclick="refreshQBusiness()" title="Refresh">
                            <i class="fas fa-refresh"></i>
                        </button>
                    </div>
                    
                    <div class="qbusiness-embed" id="qbusiness-embed">
                        <div class="embed-placeholder">
                            <div class="loading-spinner-small">
                                <div class="spinner-small"></div>
                            </div>
                            <p>Loading Amazon Q Business...</p>
                        </div>
                    </div>
                    
                    <div class="qbusiness-fallback" id="qbusiness-fallback" style="display: none;">
                        <div class="fallback-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Amazon Q Business Unavailable</h3>
                            <p>The embedded Q Business experience is currently unavailable. Please check your configuration or try again later.</p>
                            <button class="btn-primary" onclick="retryQBusiness()">
                                <i class="fas fa-retry"></i>
                                Retry Connection
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-page" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1>User Management</h1>
                </div>
                
                <div class="filters-section">
                    <div class="filter-group">
                        <input type="text" id="user-name-filter" placeholder="Filter by name...">
                        <select id="user-department-filter">
                            <option value="">All Departments</option>
                        </select>
                        <select id="user-division-filter">
                            <option value="">All Divisions</option>
                        </select>
                        <select id="user-status-filter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <button class="btn-secondary" onclick="clearUserFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
                
                <div class="user-popup-button" style="display: none;">
                    <button class="btn-popup" onclick="showAddUserModal()" title="Add User">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Department</th>
                                <th>Division</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="users-pagination"></div>
            </div>

            <!-- Datasets Page -->
            <div id="datasets-page" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="dataset-popup-button">
                        <button class="btn-popup" data-action="upload-dataset" title="Upload Dataset">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <h1>Dataset Management</h1>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Dataset Name</th>
                                <th>Uploader</th>
                                <th>Upload Time</th>
                                <th>Records</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="datasets-table-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Audit Trail Page -->
            <div id="audit-page" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1>Audit Trail</h1>
                    <p>Complete log of all system activities</p>
                </div>
                
                <div class="filters-section">
                    <div class="filter-group">
                        <select id="audit-action-filter">
                            <option value="">All Actions</option>
                        </select>
                        <select id="audit-user-filter">
                            <option value="">All Users</option>
                        </select>
                        <input type="date" id="audit-start-date">
                        <input type="date" id="audit-end-date">
                        <button class="btn-secondary" onclick="clearAuditFilters()">
                            <i class="fas fa-times"></i>
                            Clear
                        </button>
                        <button class="btn-primary" onclick="exportAuditData()">
                            <i class="fas fa-file-excel"></i>
                            Export to Excel
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Table</th>
                                <th>IP Address</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="audit-table-body">
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="audit-pagination"></div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page-content" style="display: none;">
                <div class="page-header">
                    <h1>Profile Settings</h1>
                </div>
                
                <div class="profile-container">
                    <div class="profile-photo-section">
                        <div class="photo-upload">
                            <img src="/images/default-avatar.svg" alt="Profile" id="profile-photo">
                            <div class="photo-overlay">
                                <i class="fas fa-camera"></i>
                                <span>Change Photo</span>
                            </div>
                            <input type="file" id="photo-input" accept="image/*" style="display: none;">
                        </div>
                        <div class="user-name-display">
                            <h3 id="profile-name-display">Loading...</h3>
                        </div>
                        <div class="photo-info">
                            <p><strong>Profile Photo</strong></p>
                            <p>Click to upload a new photo.<br>Recommended: 400x400px, max 5MB</p>
                        </div>
                    </div>
                    
                    <div class="profile-form-section">
                        <h2><i class="fas fa-user-cog"></i> Profile Information</h2>
                        <form id="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profile-fullname">Full Name</label>
                                    <input type="text" id="profile-fullname" name="fullname" required>
                                </div>
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" name="email" readonly>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profile-phone">Phone</label>
                                    <input type="tel" id="profile-phone" name="phone">
                                </div>
                                <div class="form-group">
                                    <label for="profile-role">Role</label>
                                    <input type="text" id="profile-role" name="role" readonly>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profile-department">Department</label>
                                    <input type="text" id="profile-department" name="department" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="profile-division">Division</label>
                                    <input type="text" id="profile-division" name="division" readonly>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="showChangePasswordModal()">
                                    <i class="fas fa-key"></i>
                                    Change Password
                                </button>
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add User Modal -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <h2>Add New User</h2>
                <span class="close" onclick="closeAddUserModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="add-user-form">
                    <div class="form-group form-group-full">
                        <label for="add-fullname">Full Name</label>
                        <input type="text" id="add-fullname" name="fullname" required>
                    </div>
                    
                    <div class="form-group form-group-full">
                        <label for="add-email">Email</label>
                        <input type="email" id="add-email" name="email" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group form-group-half">
                            <label for="add-phone">Phone</label>
                            <input type="tel" id="add-phone" name="phone">
                        </div>
                        <div class="form-group form-group-half">
                            <label for="add-role">Role</label>
                            <select id="add-role" name="role">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group form-group-half">
                            <label for="add-department">Department</label>
                            <select id="add-department" name="department">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <div class="form-group form-group-half">
                            <label for="add-division">Division</label>
                            <select id="add-division" name="division">
                                <option value="">Select Division</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" form="add-user-form" class="btn-primary">Add User</button>
                <button type="button" class="btn-secondary" onclick="closeAddUserModal()">Cancel</button>
            </div>
            
            <style>
                .form-group-full {
                    width: calc(100% - 40px);
                    margin: 0 20px 20px 20px;
                }
                .form-group-half {
                    width: calc(50% - 20px);
                    margin: 0 0 20px 0;
                }
                .form-row {
                    display: flex;
                    gap: 20px;
                    margin: 0 20px;
                }
                .modal-body {
                    padding: 20px;
                }
                .swal2-container {
                    z-index: 99999 !important;
                }
                .modal {
                    z-index: 1000;
                }
            </style>
        </div>
    </div>

    <!-- Upload Dataset Modal -->
    <div id="upload-dataset-modal" class="modal">
        <div class="modal-content upload-modal animate__animated animate__fadeInDown">
            <div class="modal-header upload-header">
                <div class="modal-title-section">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-title">
                        <h2>Upload Dataset</h2>
                        <p>Import Excel or CSV files to analyze your data</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-body upload-body">
                <div class="upload-requirements">
                    <h4><i class="fas fa-info-circle"></i> Requirements & Guidelines</h4>
                    <div class="requirements-grid">
                        <div class="requirement-item">
                            <i class="fas fa-file-excel text-success"></i>
                            <span>Excel (.xls, .xlsx) or CSV files</span>
                        </div>
                        <div class="requirement-item">
                            <i class="fas fa-weight-hanging text-warning"></i>
                            <span>Maximum file size: 300 MB</span>
                        </div>
                        <div class="requirement-item">
                            <i class="fas fa-database text-info"></i>
                            <span>Financial data with proper structure</span>
                        </div>
                        <div class="requirement-item">
                            <i class="fas fa-shield-alt text-primary"></i>
                            <span>Secure processing with audit trail</span>
                        </div>
                    </div>
                </div>
                
                <form id="upload-dataset-form" enctype="multipart/form-data">
                    <div class="upload-section">
                        <h4><i class="fas fa-tag"></i> Dataset Information</h4>
                        <div class="form-group">
                            <label for="dataset-name">Dataset Name *</label>
                            <input type="text" id="dataset-name" name="name" placeholder="e.g., Q4 2024 Financial Report" required>
                            <small class="form-help">Enter a descriptive name that clearly identifies this dataset</small>
                        </div>
                    </div>
                    
                    <div class="upload-section">
                        <h4><i class="fas fa-file-upload"></i> File Selection</h4>
                        <div class="form-group file-upload-group">
                            <div class="file-input-wrapper enhanced">
                                <input type="file" id="dataset-file" name="file" accept=".xls,.xlsx,.csv" required>
                                <div class="file-input-placeholder">
                                    <div class="upload-icon-large">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="upload-text">
                                        <h5>Drop your file here or click to browse</h5>
                                        <p>Supported formats: Excel (.xls, .xlsx) and CSV files</p>
                                        <div class="file-specs">
                                            <span class="spec-item"><i class="fas fa-check"></i> Up to 300 MB</span>
                                            <span class="spec-item"><i class="fas fa-check"></i> Automatic processing</span>
                                            <span class="spec-item"><i class="fas fa-check"></i> Progress tracking</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="file-preview" class="file-preview" style="display: none;">
                                    <div class="file-info">
                                        <i class="fas fa-file-excel file-icon"></i>
                                        <div class="file-details">
                                            <div class="file-name"></div>
                                            <div class="file-size"></div>
                                        </div>
                                        <button type="button" class="remove-file" onclick="removeSelectedFile()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="sheet-selection" style="display: none;">
                        <div class="upload-section">
                            <h4><i class="fas fa-table"></i> Sheet Selection</h4>
                            <select id="dataset-sheet" name="sheet">
                                <option value="">Select a sheet to import...</option>
                            </select>
                            <small class="form-help">Choose which Excel sheet contains your financial data</small>
                        </div>
                    </div>
                    
                    <div class="modal-footer upload-footer">
                        <div class="footer-info">
                            <i class="fas fa-lock"></i>
                            <span>Your data is processed securely and logged for audit purposes</span>
                        </div>
                        <div class="footer-actions">
                            <button type="button" class="btn-secondary" onclick="closeUploadDatasetModal()">
                                <i class="fas fa-times"></i>
                                Cancel
                            </button>
                            <button type="submit" class="btn-primary btn-upload">
                                <i class="fas fa-upload"></i>
                                Start Upload
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <h2>Edit User</h2>
                <span class="close" onclick="closeEditUserModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="edit-user-form">
                    <div class="form-group form-group-full">
                        <label for="edit-fullname">Full Name</label>
                        <input type="text" id="edit-fullname" name="fullname" required>
                    </div>
                    
                    <div class="form-group form-group-full">
                        <label for="edit-email">Email</label>
                        <input type="email" id="edit-email" name="email" required>
                    </div>
                    
                    <div class="form-group form-group-full">
                        <label for="edit-phone">Phone</label>
                        <input type="tel" id="edit-phone" name="phone">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group form-group-half">
                            <label for="edit-role">Role</label>
                            <select id="edit-role" name="role">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group form-group-half">
                            <label for="edit-status">Status</label>
                            <select id="edit-status" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group form-group-half">
                            <label for="edit-department">Department</label>
                            <select id="edit-department" name="department">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <div class="form-group form-group-half">
                            <label for="edit-division">Division</label>
                            <select id="edit-division" name="division">
                                <option value="">Select Division</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" form="edit-user-form" class="btn-primary">Apply Changes</button>
                <button type="button" class="btn-secondary" onclick="cancelEditUser()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="change-password-modal" class="modal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <div class="modal-title-section">
                    <i class="fas fa-key"></i>
                    <h2>Change Password</h2>
                </div>
                <span class="close" onclick="closeChangePasswordModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="change-password-form">
                    <div class="form-group form-group-full">
                        <label for="change-current-password">
                            <i class="fas fa-lock"></i>
                            Current Password
                        </label>
                        <div class="input-group">
                            <input type="password" id="change-current-password" name="currentPassword" placeholder="Enter your current password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('change-current-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group form-group-full">
                        <label for="change-new-password">
                            <i class="fas fa-key"></i>
                            New Password
                        </label>
                        <div class="input-group">
                            <input type="password" id="change-new-password" name="password" placeholder="Enter your new password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('change-new-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="form-help">Password must be at least 8 characters long</small>
                    </div>
                    
                    <div class="form-group form-group-full">
                        <label for="change-confirm-password">
                            <i class="fas fa-check-circle"></i>
                            Confirm New Password
                        </label>
                        <div class="input-group">
                            <input type="password" id="change-confirm-password" name="confirmPassword" placeholder="Confirm your new password" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('change-confirm-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeChangePasswordModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button type="submit" form="change-password-form" class="btn-primary">
                    <i class="fas fa-save"></i>
                    Change Password
                </button>
            </div>
        </div>
    </div>

    <!-- External Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Custom Scripts -->
    <script src="/js/app.js"></script>
    <script src="/js/password-toggle.js"></script>
    <script src="/js/chunked-upload.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/dashboard.js"></script>
    <script src="/js/users.js"></script>
    <script src="/js/datasets.js"></script>
    <script src="/js/audit.js"></script>
    <script src="/js/profile.js"></script>
    <script src="/js/qbusiness.js"></script>
</body>
</html>